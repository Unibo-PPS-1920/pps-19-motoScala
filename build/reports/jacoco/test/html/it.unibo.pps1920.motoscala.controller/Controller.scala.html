<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pps-19-motoScala</a> &gt; <a href="index.source.html" class="el_package">it.unibo.pps1920.motoscala.controller</a> &gt; <span class="el_source">Controller.scala</span></div><h1>Controller.scala</h1><pre class="source lang-java linenums">package it.unibo.pps1920.motoscala.controller

import java.util.UUID
import java.util.UUID.randomUUID

import it.unibo.pps1920.motoscala
import it.unibo.pps1920.motoscala.controller.managers.audio.{MediaEvent, SoundAgent}
import it.unibo.pps1920.motoscala.controller.mediation.Mediator
import it.unibo.pps1920.motoscala.ecs.components.Shape.Circle
import it.unibo.pps1920.motoscala.engine.Engine
import it.unibo.pps1920.motoscala.model.Level
import it.unibo.pps1920.motoscala.model.Level.{Coordinate, LevelData}
import it.unibo.pps1920.motoscala.view.ObserverUI
import it.unibo.pps1920.motoscala.view.events.ViewEvent.LevelDataEvent
import it.unibo.pps1920.motoscala.view.utilities.ViewConstants
import org.slf4j.LoggerFactory

trait Controller extends ActorController with SoundController with ObservableUI {
}

<span class="nc" id="L21">object Controller {</span>
<span class="nc" id="L22">  def apply(): Controller = new ControllerImpl()</span>
<span class="nc" id="L23">  private class ControllerImpl private[Controller]() extends Controller {</span>
<span class="nc" id="L24">    private val logger = LoggerFactory getLogger classOf[ControllerImpl]</span>
<span class="nc" id="L25">    private val mediator = Mediator()</span>
<span class="nc" id="L26">    private val myUuid: UUID = randomUUID()</span>
<span class="nc" id="L27">    private var engine: Option[Engine] = None</span>
<span class="nc" id="L28">    private var observers: Set[ObserverUI] = Set()</span>
<span class="nc" id="L29">    private var levels: List[LevelData] = List()</span>
<span class="nc" id="L30">    private var soundAgent: SoundAgent = SoundAgent()</span>
<span class="nc" id="L31">    this.soundAgent.start()</span>

<span class="nc" id="L33">    override def redirectSoundEvent(me: MediaEvent): Unit = this.soundAgent.enqueueEvent(me)</span>
<span class="nc" id="L34">    override def attachUI(obs: ObserverUI*): Unit = observers = observers ++ obs</span>
<span class="nc" id="L35">    override def detachUI(obs: ObserverUI*): Unit = observers = observers -- obs</span>
    override def setupGame(level: Level): Unit = {
<span class="nc" id="L37">      logger info s&quot;level selected: $level&quot;</span>
<span class="nc" id="L38">      engine = Option(motoscala.engine.GameEngine(mediator, myUuid))</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">      engine.get.init(levels.filter(data =&gt; data.index == level).head)</span>
    }

<span class="nc" id="L42">    override def start(): Unit = engine.get.start()</span>
<span class="nc" id="L43">    override def getMediator: Mediator = mediator</span>
    override def loadAllLevels(): Unit = {
<span class="nc" id="L45">      levels = List(LevelData(0, Coordinate(ViewConstants.Canvas.CanvasWidth, ViewConstants.Canvas.CanvasHeight),</span>
<span class="nc" id="L46">                              List(Level.Player(Coordinate(500, 500), Circle(25), Coordinate(0, 0), Coordinate(10, 10)),</span>
                                   Level
<span class="nc" id="L48">                                     .RedPupa(Coordinate(600, 500), Circle(25), Coordinate(0, 0), Coordinate(5, 5)),</span>
                                   Level
<span class="nc" id="L50">                                     .RedPupa(Coordinate(600, 100), Circle(25), Coordinate(0, 0), Coordinate(5, 5)),</span>
                                   Level
<span class="nc" id="L52">                                     .RedPupa(Coordinate(600, 300), Circle(25), Coordinate(0, 0), Coordinate(5, 5)),</span>
                                   Level
<span class="nc" id="L54">                                     .RedPupa(Coordinate(300, 100), Circle(25), Coordinate(0, 0), Coordinate(5, 5)),</span>
                                   Level
<span class="nc" id="L56">                                     .RedPupa(Coordinate(600, 500), Circle(25), Coordinate(0, 0), Coordinate(5, 5))</span>
                                   )))
<span class="nc" id="L58">      observers.foreach(o =&gt; o.notify(LevelDataEvent(levels)))</span>
    }
<span class="nc" id="L60">    override def pause(): Unit = engine.get.pause()</span>
<span class="nc" id="L61">    override def resume(): Unit = engine.get.resume()</span>
    override def stop(): Unit = {
<span class="nc" id="L63">      engine.get.stop()</span>
<span class="nc" id="L64">      engine = None</span>
    }
  }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>