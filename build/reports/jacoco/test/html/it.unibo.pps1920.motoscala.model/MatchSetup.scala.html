<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MatchSetup.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pps-19-motoScala</a> &gt; <a href="index.source.html" class="el_package">it.unibo.pps1920.motoscala.model</a> &gt; <span class="el_source">MatchSetup.scala</span></div><h1>MatchSetup.scala</h1><pre class="source lang-java linenums">package it.unibo.pps1920.motoscala.model

import akka.actor.ActorRef
import it.unibo.pps1920.motoscala.model.MatchSetup.Data.PlayerData
import it.unibo.pps1920.motoscala.multiplayer.messages.ErrorMsg.ErrorReason

import scala.collection.mutable
trait MatchSetup {
}
/** Provide default MatchSetup instance. */
<span class="nc" id="L11">object MatchSetup {</span>
  /** A [[MatchSetup]] represents the match setup.
   *
   * @param difficulty the difficulty of the match
   * @param numPlayers the match max player
   * @param level the match selected level
   */
<span class="nc bnc" id="L18" title="All 26 branches missed.">  case class MultiPlayerSetup(var difficulty: Int = 1, var level: Int = 1, var numPlayers: Int = 4) extends MatchSetup {</span>
<span class="nc" id="L19">    private var _readyPlayers: mutable.Map[ActorRef, PlayerData] = mutable.LinkedHashMap()</span>

    import MagicValues._

    /** Set the status of a player, it can be true or false, where false means not ready.
     *
     * @param playerRef the player reference
     * @param isReady the palyer new status
     */
    def setPlayerStatus(playerRef: ActorRef, isReady: Boolean): Unit =
<span class="nc bnc" id="L29" title="All 2 branches missed.">      if (_readyPlayers.contains(playerRef))</span>
<span class="nc" id="L30">        _readyPlayers.update(playerRef, PlayerData(_readyPlayers(playerRef).name, status = isReady))</span>
    /** Return a copy of the player map.
     *
     * @return the match map of present player
     * */
<span class="nc" id="L35">    def getPlayerStatus: mutable.Map[ActorRef, PlayerData] = _readyPlayers.clone()</span>
    /** Return the number of ready player present inside the match. */
<span class="nc" id="L37">    def numReadyPlayers(): Int = _readyPlayers.count(rp =&gt; rp._2.status)</span>
    /** Try to add one player, to the match, it can fail if the name already exist or if the lobby is full.
     *
     * @param playerRef the player reference
     * @param name the name of the new player
     * @return an option contains the error reason if presents
     */
    def tryAddPlayer(playerRef: ActorRef, name: String): Option[ErrorReason] = {
<span class="nc bnc" id="L45" title="All 8 branches missed.">      if (_readyPlayers.values.exists(playerData =&gt; playerData.name == name))</span>
<span class="nc" id="L46">        return Some(ErrorReason(TitleNameAlreadyTakenError, TextNameAlreadyTakenError))</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">      else if (_readyPlayers.size &lt; numPlayers) {</span>
<span class="nc" id="L48">        _readyPlayers += (playerRef -&gt; PlayerData(name, status = false))</span>
<span class="nc" id="L49">        return None</span>
      }
<span class="nc" id="L51">      Some(ErrorReason(TitleLobbyFullTakenError, TextNamLobbyFullTakenError))</span>
    }
    /** Remove one player from the match.
     *
     * @param name the name of the player to remove
     */
    def removePlayer(name: String): ActorRef = {
<span class="nc bnc" id="L58" title="All 6 branches missed.">      val player = _readyPlayers.find(_._2.name == name).get</span>
<span class="nc" id="L59">      _readyPlayers.remove(player._1)</span>
<span class="nc" id="L60">      player._1</span>
    }
<span class="nc bnc" id="L62" title="All 4 branches missed.">    private object MagicValues {</span>
      final val TitleNameAlreadyTakenError = &quot;Name already taken&quot;
      final val TextNameAlreadyTakenError = &quot;Choose another name&quot;
      final val TitleLobbyFullTakenError = &quot;Lobby full&quot;
      final val TextNamLobbyFullTakenError = &quot;No more slots available&quot;
    }
<span class="nc" id="L68">  }</span>

<span class="nc" id="L70">  object Data {</span>
    /** Represent the name and the status of one player.
     *
     * @param status the player status
     * @param name the player name
     */
<span class="nc bnc" id="L76" title="All 28 branches missed.">    case class PlayerData(var name: String, var status: Boolean)</span>
  }
<span class="nc" id="L78">}</span>


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>