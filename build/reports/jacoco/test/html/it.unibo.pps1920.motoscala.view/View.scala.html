<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>View.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pps-19-motoScala</a> &gt; <a href="index.source.html" class="el_package">it.unibo.pps1920.motoscala.view</a> &gt; <span class="el_source">View.scala</span></div><h1>View.scala</h1><pre class="source lang-java linenums">package it.unibo.pps1920.motoscala.view

import it.unibo.pps1920.motoscala.controller.ObservableUI
import it.unibo.pps1920.motoscala.controller.managers.audio.MediaEvent.PlayMusicEvent
import it.unibo.pps1920.motoscala.controller.managers.audio.Music
import it.unibo.pps1920.motoscala.view.events.ViewEvent
import it.unibo.pps1920.motoscala.view.fsm.{ChangeScreenEvent, ViewStateMachine}
import it.unibo.pps1920.motoscala.view.screens._
import it.unibo.pps1920.motoscala.view.screens.game.ScreenControllerGame
import it.unibo.pps1920.motoscala.view.screens.home.ScreenControllerHome
import it.unibo.pps1920.motoscala.view.screens.levels.ScreenControllerLevels
import it.unibo.pps1920.motoscala.view.screens.lobby.ScreenControllerLobby
import it.unibo.pps1920.motoscala.view.screens.modeSelection.ScreenControllerModeSelection
import it.unibo.pps1920.motoscala.view.screens.settings.ScreenControllerSettings
import it.unibo.pps1920.motoscala.view.screens.stats.ScreenControllerStats
import it.unibo.pps1920.motoscala.view.utilities.ViewUtils
import javafx.application.Platform
import javafx.scene.Scene
import javafx.stage.Stage
import scalafx.scene.layout.StackPane

/** Facade class that exposes method to screens */
protected[view] trait ViewFacade {

  /** Get the primary stage */
  def getStage: Stage

  /** Display an other screen
   *
   * @param screen the Fxml screen
   */
  def changeScreen(screen: ChangeScreenEvent): Unit
}

/** Represents the view part in the mvc pattern */
trait View extends ObserverUI {

  /** Start the view and show the primary stage */
  def start(): Unit
}

<span class="nc" id="L42">object View {</span>
  /** Factory for [[View]] instances */
  def apply(controller: ObservableUI): View = {
<span class="nc bnc" id="L45" title="All 2 branches missed.">    require(controller != null)</span>
<span class="nc" id="L46">    new ViewImpl(controller)</span>
  }

<span class="nc" id="L49">  private class ViewImpl(controller: ObservableUI) extends View with ViewFacade {</span>
<span class="nc" id="L50">    private val stateMachine = ViewStateMachine.buildStateMachine()</span>
<span class="nc" id="L51">    private val screenLoader = ScreenLoader()</span>
<span class="nc" id="L52">    private val root = new StackPane()</span>
<span class="nc" id="L53">    private val scene = new Scene(root)</span>
<span class="nc" id="L54">    private var stage: Option[Stage] = None</span>

<span class="nc" id="L56">    controller attachUI this</span>
<span class="nc" id="L57">    loadScreens()</span>

<span class="nc" id="L59">    override def getStage: Stage = stage.get</span>

    override def start(): Unit = {
<span class="nc" id="L62">      Platform.runLater(() =&gt; {</span>
<span class="nc" id="L63">        val stage = ViewUtils.createStage(scene)</span>
<span class="nc" id="L64">        changeScreen(ChangeScreenEvent.GotoHome)</span>
<span class="nc" id="L65">        this.stage = Some(stage)</span>
<span class="nc" id="L66">        controller.redirectSoundEvent(PlayMusicEvent(Music.Home))</span>
      })
    }

    override def changeScreen(event: ChangeScreenEvent): Unit = {
<span class="nc" id="L71">      Platform.runLater(() =&gt; {</span>
<span class="nc" id="L72">        screenLoader.applyScreen(stateMachine.consume(event), root)</span>
<span class="nc" id="L73">        screenLoader.getScreenController(stateMachine.currentState).whenDisplayed()</span>
      })
    }

<span class="nc" id="L77">    override def notify(ev: ViewEvent): Unit = ev match {</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">      case event: ViewEvent.HomeEvent =&gt; screenLoader.getScreenController(FXMLScreens.HOME).notify(event)</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">      case event: ViewEvent.GameEvent =&gt; screenLoader.getScreenController(FXMLScreens.GAME).notify(event)</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">      case event: ViewEvent.LevelEvent =&gt; screenLoader.getScreenController(FXMLScreens.LEVELS).notify(event)</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">      case event: ViewEvent.LobbyEvent =&gt; screenLoader.getScreenController(FXMLScreens.LOBBY).notify(event)</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">      case event: ViewEvent.SettingsEvent =&gt; screenLoader.getScreenController(FXMLScreens.SETTINGS).notify(event)</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">      case event: ViewEvent.StatsEvent =&gt; screenLoader.getScreenController(FXMLScreens.STATS).notify(event)</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">      case event: ViewEvent.SelectionEvent =&gt; screenLoader.getScreenController(FXMLScreens.SELECTION).notify(event)</span>
<span class="nc" id="L85">      case _ =&gt;</span>
    }

    private def loadScreens(): Unit = {
<span class="nc" id="L89">      loadFXMLNode(FXMLScreens.STATS, new ScreenControllerStats(this, controller))</span>
<span class="nc" id="L90">      loadFXMLNode(FXMLScreens.SETTINGS, new ScreenControllerSettings(this, controller))</span>
<span class="nc" id="L91">      loadFXMLNode(FXMLScreens.LOBBY, new ScreenControllerLobby(this, controller))</span>
<span class="nc" id="L92">      loadFXMLNode(FXMLScreens.GAME, new ScreenControllerGame(this, controller))</span>
<span class="nc" id="L93">      loadFXMLNode(FXMLScreens.LEVELS, new ScreenControllerLevels(this, controller))</span>
<span class="nc" id="L94">      loadFXMLNode(FXMLScreens.HOME, new ScreenControllerHome(this, controller))</span>
<span class="nc" id="L95">      loadFXMLNode(FXMLScreens.SELECTION, new ScreenControllerModeSelection(this, controller))</span>
    }

<span class="nc" id="L98">    private def loadFXMLNode(screen: FXMLScreens, controller: ScreenController): Unit = screenLoader</span>
<span class="nc" id="L99">      .loadFXMLNode(screen, controller)</span>
  }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>